<app-toolbar [showPDF]="true" title="REPORTE" (pdf)="generatePDF()"></app-toolbar>
<div class="container-fluid" [@fadeInOnEnter]>
  <form [formGroup]="searchForm">
    <mat-card class="shipping-card">
      <mat-card-header>
        <mat-card-title>Busqueda avanzada</mat-card-title>
        <mat-card-subtitle>Seleccione el tipo de tramite que desea buscar</mat-card-subtitle>
      </mat-card-header>
      <section class="example-section">
        <label class="example-margin">Tramites:</label>
        <mat-radio-group (change)="selectTypeSearch($event.value)">
          <mat-radio-button class="example-margin" [value]="'EXTERNO'">Externos</mat-radio-button>
          <mat-radio-button class="example-margin" [value]="'INTERNO'">Internos</mat-radio-button>
        </mat-radio-group>
      </section>
      <mat-card-content *ngIf="grupo">
        <div class="row">
          <div class="col-sm-3">
            <mat-form-field class="full-width">
              <input matInput placeholder="Alterno" formControlName="alterno">
            </mat-form-field>
          </div>
          <div class="col-sm-3">
            <mat-form-field class="full-width">
              <mat-select placeholder="Estado" formControlName="estado">
                <mat-option [value]="null">
                  -
                </mat-option>
                <mat-option *ngFor="let estado of estados" [value]="estado">
                  {{estado }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-sm-3">
            <mat-form-field class="full-width">
              <input matInput placeholder="Cite" formControlName="cite">
            </mat-form-field>
          </div>
          <div class="col-sm-3">
            <mat-form-field class="full-width">
              <mat-label>Ingrese el intervalo</mat-label>
              <mat-date-range-input [rangePicker]="picker">
                <input matStartDate formControlName="start" placeholder="Start date">
                <input matEndDate formControlName="end" placeholder="End date">
              </mat-date-range-input>
              <mat-hint>MM/DD/YYYY â€“ MM/DD/YYYY</mat-hint>
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-date-range-picker #picker></mat-date-range-picker>
              <mat-error *ngIf="searchForm.controls.start.hasError('matStartDateInvalid')">Invalid start
                date</mat-error>
              <mat-error *ngIf="searchForm.controls.end.hasError('matEndDateInvalid')">Invalid end date</mat-error>
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div *ngIf="grupo=='EXTERNO'" class="col-sm-2">
            <mat-form-field class="example-full-width">
              <mat-label>Segmento</mat-label>
              <mat-select (selectionChange)="getTypes($event.value)">
                <mat-option *ngFor="let segmento of segmentos" [value]="segmento">
                  {{segmento|uppercase}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-sm-10">
            <mat-form-field class="example-full-width">
              <mat-label>Seleccione el tipo de tramite</mat-label>
              <mat-select formControlName="tipo_tramite">
                <mat-option [value]="null">
                  -
                </mat-option>
                <mat-option *ngFor="let tipo of tipos" [value]="tipo.id_tipoTramite">
                  {{tipo.nombre| uppercase}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

      </mat-card-content>
      <mat-divider></mat-divider>
      <mat-card-actions>
        <button mat-stroked-button color="primary" (click)="searchExternos()">Buscar</button>
        <button mat-button color="primary" (click)="reset()">Restablecer</button>
        <button mat-button color="primary" (click)="generatePDF()">Generar</button>
      </mat-card-actions>
    </mat-card>
  </form>
  <ng-container [ngTemplateOutlet]="grupo === 'EXTERNO' ? formSearchExterno : grupo === 
   'INTERNO' ? formSearchInterno : formSearchEmpty"></ng-container>
  <div class="example-container mat-elevation-z8">
    <div class="example-table-container">
      <ng-template #formSearchExterno>
        <table mat-table [dataSource]="dataSource" [class.isMobile]="'isMobile'">
          <ng-container matColumnDef="alterno">
            <th mat-header-cell *matHeaderCellDef>Alterno</th>
            <td mat-cell *matCellDef="let row">
              <a [routerLink]="['ficha', row._id]">
                {{row.alterno}}
              </a>
            </td>
          </ng-container>
          <ng-container matColumnDef="tramite">
            <th mat-header-cell *matHeaderCellDef>Tramite</th>
            <td mat-cell *matCellDef="let row">{{row.tipo_tramite.nombre|uppercase}}</td>
          </ng-container>
          <ng-container matColumnDef="descripcion">
            <th mat-header-cell *matHeaderCellDef>Referencia</th>
            <td mat-cell *matCellDef="let row">
              {{row.detalle}}
            </td>
          </ng-container>
          <ng-container matColumnDef="solicitante">
            <th mat-header-cell *matHeaderCellDef>Solicitante</th>
            <td mat-cell *matCellDef="let row">
              {{row.solicitante}}
            </td>
          </ng-container>
          <ng-container matColumnDef="estado">
            <th mat-header-cell *matHeaderCellDef> Estado </th>
            <td mat-cell *matCellDef="let row">
              <span class="badge" [ngClass]="row.estado|state">
                {{row.estado}}
              </span>
            </td>
          </ng-container>
          <ng-container matColumnDef="fecha_registro">
            <th mat-header-cell *matHeaderCellDef>Fecha</th>
            <td mat-cell *matCellDef="let row">{{row.fecha_registro|date:'short'}}</td>
          </ng-container>
          <ng-container matColumnDef="opciones" justify="end">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let row">
              <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">

              </mat-menu>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </ng-template>
      <ng-template #formSearchInterno>
        <table mat-table [dataSource]="dataSource">
          <ng-container matColumnDef="alterno">
            <th mat-header-cell *matHeaderCellDef> Alterno </th>
            <td mat-cell *matCellDef="let element">
              <a [routerLink]="['ficha', element._id]">
                {{element.alterno}}
              </a>
            </td>
          </ng-container>
          <ng-container matColumnDef="tipo_tramite">
            <th mat-header-cell *matHeaderCellDef> Tramite </th>
            <td mat-cell *matCellDef="let element"> {{element.tipo_tramite.nombre}} </td>
          </ng-container>

          <ng-container matColumnDef="detalle">
            <th mat-header-cell *matHeaderCellDef> Referencia </th>
            <td mat-cell *matCellDef="let element"> {{element.detalle|uppercase}} </td>
          </ng-container>
          <ng-container matColumnDef="solicitante">
            <th mat-header-cell *matHeaderCellDef> Solicitante </th>
            <td mat-cell *matCellDef="let element">
              {{element.remitente.nombre |titlecase}}
            </td>
          </ng-container>
          <ng-container matColumnDef="destinatario">
            <th mat-header-cell *matHeaderCellDef> Destinatario </th>
            <td mat-cell *matCellDef="let element">
              {{element.destinatario.nombre|titlecase}}
            </td>
          </ng-container>
          <ng-container matColumnDef="estado">
            <th mat-header-cell *matHeaderCellDef> Estado </th>
            <td mat-cell *matCellDef="let element">
              <span class="badge" [ngClass]="element.estado|state">
                {{element.estado|uppercase}}
              </span>
            </td>
          </ng-container>
          <ng-container matColumnDef="cite">
            <th mat-header-cell *matHeaderCellDef> Cite </th>
            <td mat-cell *matCellDef="let element">
              {{element.cite!=""?element.cite:'S / C'}}
            </td>
          </ng-container>
          <ng-container matColumnDef="fecha">
            <th mat-header-cell *matHeaderCellDef> Fecha </th>
            <td mat-cell *matCellDef="let element">
              {{element.fecha_registro|date:'short'}}
            </td>
          </ng-container>

          <ng-container matColumnDef="opciones">
            <th mat-header-cell *matHeaderCellDef> </th>
            <td mat-cell *matCellDef="let element">
              <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">

              </mat-menu>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>


      </ng-template>
      <ng-template #formSearchEmpty>

      </ng-template>
      <mat-paginator [length]="lengthData" [pageSizeOptions]="[10, 20, 30, 50]" showFirstLastButtons></mat-paginator>
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="4">Sin resultados para el termino </td>
      </tr>

    </div>